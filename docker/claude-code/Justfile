image := "claude-code"
config_dir := env("HOME") / ".config/claude-container"

[private]
default:
    @just --list

build:
    @echo "ðŸ”¨  Building Claude Code container..."
    docker build -t {{ image }} -f {{ source_directory() }}/Dockerfile {{ source_directory() }}
    @echo "âœ…  Built!"

run workspace='':
    #!/usr/bin/env bash
    set -euo pipefail
    ws="{{ if workspace == '' { `pwd` } else { workspace } }}"
    mkdir -p "{{ config_dir }}"
    echo "ðŸš€  Starting Claude Code container..."
    echo "    Workspace: $ws"
    echo "    Config:    {{ config_dir }}"
    docker run --rm -it \
      -v "$ws:/workspace" \
      -v "{{ config_dir }}:/claude" \
      -e "CLAUDE_CONFIG_DIR=/claude" \
      -e "USER_UID=$(id -u)" \
      -e "USER_GID=$(id -g)" \
      {{ image }}

yolo workspace='':
    #!/usr/bin/env bash
    set -euo pipefail
    ws="{{ if workspace == '' { `pwd` } else { workspace } }}"
    mkdir -p "{{ config_dir }}"
    echo "ðŸš€  Starting Claude Code container (yolo mode)..."
    echo "    Workspace: $ws"
    echo "    Config:    {{ config_dir }}"
    docker run --rm -it \
      -v "$ws:/workspace" \
      -v "{{ config_dir }}:/claude" \
      -e "CLAUDE_CONFIG_DIR=/claude" \
      -e "USER_UID=$(id -u)" \
      -e "USER_GID=$(id -g)" \
      {{ image }} claude --dangerously-skip-permissions

shell workspace='':
    #!/usr/bin/env bash
    set -euo pipefail
    ws="{{ if workspace == '' { `pwd` } else { workspace } }}"
    mkdir -p "{{ config_dir }}"
    docker run --rm -it \
      -v "$ws:/workspace" \
      -v "{{ config_dir }}:/claude" \
      -e "CLAUDE_CONFIG_DIR=/claude" \
      -e "USER_UID=$(id -u)" \
      -e "USER_GID=$(id -g)" \
      {{ image }} /bin/bash
